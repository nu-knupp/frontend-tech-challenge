<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Financial Dashboard - Single-SPA Root Config</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: #333;
    }

    .header {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 1rem 2rem;
      box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    .header h1 {
      color: #4a5568;
      font-size: 1.8rem;
      font-weight: 600;
    }

    .navigation {
      background: rgba(255, 255, 255, 0.9);
      padding: 1rem 2rem;
      display: flex;
      gap: 1rem;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .nav-button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      transition: all 0.3s ease;
      position: relative;
    }

    .nav-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
    }

    .nav-button.active {
      background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
    }

    .status-indicator {
      display: inline-block;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      margin-left: 8px;
    }

    .status-online {
      background-color: #10b981;
      box-shadow: 0 0 8px rgba(16, 185, 129, 0.4);
    }

    .status-offline {
      background-color: #ef4444;
      box-shadow: 0 0 8px rgba(239, 68, 68, 0.4);
    }

    .container {
      max-width: 100%;
      margin: 0;
      height: calc(100vh - 140px);
    }

    #microfrontend-container {
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      color: #667eea;
    }

    .loading-state {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 200px;
      font-size: 1.2rem;
      color: #667eea;
    }

    .welcome-message {
      text-align: center;
      padding: 3rem;
      color: #4a5568;
    }

    .welcome-message h2 {
      font-size: 2rem;
      margin-bottom: 1rem;
    }

    .welcome-message p {
      font-size: 1.1rem;
      line-height: 1.6;
      max-width: 600px;
      margin: 0 auto;
    }

    @media (max-width: 768px) {
      .navigation {
        flex-direction: column;
        gap: 0.5rem;
      }

      .nav-button {
        justify-content: center;
      }
    }
  </style>
</head>

<body>
  <div class="header">
    <h1>üè¶ Financial Dashboard - Single-SPA Architecture</h1>
  </div>

  <nav class="navigation">
    <a href="#/home" class="nav-button" onclick="navigateToMicrofrontend('#/home')">
      üè† Home
      <span class="status-indicator status-offline" id="status-home"></span>
    </a>
    <a href="#/analytics" class="nav-button" onclick="navigateToMicrofrontend('#/analytics')">
      üìä Analytics
      <span class="status-indicator status-offline" id="status-analytics"></span>
    </a>
    <a href="#/transactions" class="nav-button" onclick="navigateToMicrofrontend('#/transactions')">
      üí≥ Transactions
      <span class="status-indicator status-offline" id="status-transactions"></span>
    </a>
  </nav>

  <div class="container">
    <!-- Container onde os micro-frontends ser√£o montados -->
    <div id="microfrontend-container">
      <div class="welcome-message">
        <h2>Bem-vindo ao Financial Dashboard</h2>
        <p>
          Esta √© uma arquitetura Single-SPA com micro-frontends servidos via Nginx reverse proxy.
          Clique em uma das op√ß√µes acima para navegar entre os diferentes m√≥dulos.
        </p>
      </div>
    </div>
  </div>

  <!-- Import Single-SPA -->
  <script src="https://cdn.jsdelivr.net/npm/single-spa@6.0.1/lib/umd/single-spa.min.js"></script>

  <!-- Root config - ser√° carregado via importmap ou script direto -->
  <script type="module" src="/src/root-config.js"></script>

  <script>
    // Fun√ß√£o helper para navega√ß√£o (chamada pelos bot√µes)
    function navigateToMicrofrontend(route) {
      // Atualizar bot√µes ativos
      document.querySelectorAll('.nav-button').forEach(btn => {
        btn.classList.remove('active');
      });

      // Marcar bot√£o ativo baseado na rota
      const activeButton = document.querySelector(`a[href="${route}"]`);
      if (activeButton) {
        activeButton.classList.add('active');
      }

      // Navegar via Single-SPA
      if (window.navigateToMicrofrontend) {
        window.navigateToMicrofrontend(route);
      } else {
        window.location.hash = route;
      }
    }

    // Marcar bot√£o ativo baseado no hash atual
    function updateActiveButton() {
      const currentHash = window.location.hash || '#/home';
      document.querySelectorAll('.nav-button').forEach(btn => {
        btn.classList.remove('active');
      });

      const activeButton = document.querySelector(`a[href="${currentHash}"]`);
      if (activeButton) {
        activeButton.classList.add('active');
      }
    }

    // Atualizar bot√£o ativo quando o hash mudar
    window.addEventListener('hashchange', updateActiveButton);

    // Atualizar bot√£o ativo no carregamento da p√°gina
    document.addEventListener('DOMContentLoaded', () => {
      updateActiveButton();

      // Se n√£o h√° hash, navegar para home
      if (!window.location.hash) {
        navigateToMicrofrontend('#/home');
      }
    });
  </script>
</body>

</html>

.nav-card {
background: rgba(255, 255, 255, 0.95);
backdrop-filter: blur(10px);
border-radius: 16px;
padding: 2rem;
box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
transition: all 0.3s ease;
cursor: pointer;
border: 2px solid transparent;
}

.nav-card:hover {
transform: translateY(-8px);
box-shadow: 0 16px 40px rgba(0, 0, 0, 0.15);
border-color: #667eea;
}

.nav-card.active {
border-color: #667eea;
background: rgba(102, 126, 234, 0.1);
}

.nav-card h3 {
color: #4a5568;
font-size: 1.4rem;
margin-bottom: 0.5rem;
display: flex;
align-items: center;
gap: 0.5rem;
}

.nav-card p {
color: #718096;
line-height: 1.6;
}

.icon {
font-size: 1.5rem;
}

.iframe-container {
background: rgba(255, 255, 255, 0.95);
backdrop-filter: blur(10px);
border-radius: 16px;
box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
overflow: hidden;
min-height: 600px;
}

.iframe-container iframe {
width: 100%;
height: 600px;
border: none;
display: block;
}

.loading {
display: flex;
align-items: center;
justify-content: center;
height: 600px;
color: #667eea;
font-size: 1.2rem;
}

.status-indicator {
display: inline-block;
width: 8px;
height: 8px;
border-radius: 50%;
margin-right: 8px;
}

.status-online {
background-color: #10b981;
box-shadow: 0 0 8px rgba(16, 185, 129, 0.4);
}

.status-offline {
background-color: #ef4444;
box-shadow: 0 0 8px rgba(239, 68, 68, 0.4);
}

@media (max-width: 768px) {
.container {
padding: 0 1rem;
}

.nav-cards {
grid-template-columns: 1fr;
gap: 1rem;
}

.nav-card {
padding: 1.5rem;
}
}
</style>
</head>

<body>
  <div class="header">
    <h1>üè¶ Financial Dashboard - Micro-Frontend Architecture</h1>
  </div>

  <div class="container">
    <div class="nav-cards">
      <div class="nav-card" data-url="http://localhost:9001" data-name="home">
        <h3>
          <span class="icon">üè†</span>
          Home & Transactions
          <span class="status-indicator status-offline" id="status-home"></span>
        </h3>
        <p>Visualize o resumo financeiro, gerencie transa√ß√µes e acompanhe seu saldo em tempo real.</p>
      </div>

      <div class="nav-card" data-url="http://localhost:9002" data-name="analytics">
        <h3>
          <span class="icon">üìä</span>
          Analytics & Reports
          <span class="status-indicator status-offline" id="status-analytics"></span>
        </h3>
        <p>An√°lises detalhadas, gr√°ficos de tend√™ncias e m√©tricas financeiras avan√ßadas.</p>
      </div>

      <div class="nav-card" data-url="http://localhost:9003" data-name="transactions">
        <h3>
          <span class="icon">üí≥</span>
          Transaction Manager
          <span class="status-indicator status-offline" id="status-transactions"></span>
        </h3>
        <p>Gerencie todas as suas transa√ß√µes, categorias e hist√≥rico completo.</p>
      </div>
    </div>

    <div class="iframe-container">
      <div class="loading" id="loading">
        Selecione um micro-frontend acima para come√ßar...
      </div>
      <iframe id="micro-frontend-frame" style="display: none;"></iframe>
    </div>
  </div>

  <script>
    class MicroFrontendOrchestrator {
      constructor() {
        this.currentApp = null;
        this.apps = {
          home: { url: 'http://localhost:9001', name: 'Home' },
          analytics: { url: 'http://localhost:9002', name: 'Analytics' },
          transactions: { url: 'http://localhost:9003', name: 'Transactions' }
        };

        this.init();
        this.checkMicroFrontendStatus();

        // Check status every 30 seconds
        setInterval(() => this.checkMicroFrontendStatus(), 30000);
      }

      init() {
        const cards = document.querySelectorAll('.nav-card');
        const iframe = document.getElementById('micro-frontend-frame');
        const loading = document.getElementById('loading');

        cards.forEach(card => {
          card.addEventListener('click', () => {
            const url = card.dataset.url;
            const name = card.dataset.name;

            this.loadMicroFrontend(url, name);
            this.setActiveCard(card);
          });
        });
      }

      loadMicroFrontend(url, name) {
        const iframe = document.getElementById('micro-frontend-frame');
        const loading = document.getElementById('loading');

        loading.style.display = 'flex';
        loading.textContent = `Carregando ${this.apps[name]?.name || name}...`;
        iframe.style.display = 'none';

        iframe.src = url;
        this.currentApp = name;

        iframe.onload = () => {
          loading.style.display = 'none';
          iframe.style.display = 'block';
        };

        iframe.onerror = () => {
          loading.textContent = `Erro ao carregar ${this.apps[name]?.name || name}. Verifique se o servi√ßo est√° rodando.`;
        };
      }

      setActiveCard(activeCard) {
        document.querySelectorAll('.nav-card').forEach(card => {
          card.classList.remove('active');
        });
        activeCard.classList.add('active');
      }

      async checkMicroFrontendStatus() {
        for (const [key, app] of Object.entries(this.apps)) {
          const statusElement = document.getElementById(`status-${key}`);

          try {
            const response = await fetch(app.url, {
              mode: 'no-cors',
              cache: 'no-cache'
            });

            statusElement.className = 'status-indicator status-online';
            statusElement.title = `${app.name} est√° online`;
          } catch (error) {
            statusElement.className = 'status-indicator status-offline';
            statusElement.title = `${app.name} est√° offline`;
          }
        }
      }
    }

    // Initialize the orchestrator when the page loads
    document.addEventListener('DOMContentLoaded', () => {
      new MicroFrontendOrchestrator();
    });
  </script>
</body>

</html>